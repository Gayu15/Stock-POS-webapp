<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stock & POS ‚Äî Single File App (with Loans, Laptops, Expenses)</title>

<!-- Styles -->
<link rel="stylesheet" href="style.css"/>

<!-- libs for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</head>
<body>

<!-- Header -->
<div class="header" role="banner">
  <div style="display:flex;align-items:center">
    <img id="headerLogo" src="GTMlogo.png" alt="logo">
    <div>
      <h1 id="headerTitle">GURU THOZHIL MAIYAM</h1>
      <div style="font-size:12px;opacity:0.9" id="headerSubtitle">Stock & POS</div>
    </div>
  </div>
  <div class="right-area">
    <span id="greeting" style="font-weight:700;color:#fff;margin-right:12px"></span>
    <button id="logoutBtn" class="nav-btn ghost" style="display:none" onclick="logout()">Logout</button>
  </div>
</div>

<!-- Navbar -->
<div class="navbar" role="navigation" id="mainNav" style="display:none">
  <button class="nav-btn active" data-target="dashboard" onclick="showSection('dashboard')">Dashboard</button>
  <button class="nav-btn" data-target="inventory" onclick="showSection('inventory')">Inventory</button>
  <button class="nav-btn" data-target="pos" onclick="showSection('pos')">POS / Sell</button>
  <button class="nav-btn" data-target="transactions" onclick="showSection('transactions')">Transactions</button>
  <button class="nav-btn" data-target="reports" onclick="showSection('reports')">Reports</button>
  <button class="nav-btn" data-target="invoices" onclick="showSection('invoices')">Invoices</button>
  <button class="nav-btn" data-target="loans" onclick="showSection('loans')">Loans</button>
  <button class="nav-btn" data-target="laptops" onclick="showSection('laptops')">Laptops</button>
  <button class="nav-btn" data-target="expenses" onclick="showSection('expenses')">Expenses</button>
  <button class="nav-btn" data-target="settings" onclick="showSection('settings')">Settings</button>
  <div style="flex:1"></div>
  <button class="nav-btn ghost small" onclick="exportAllData()">Export JSON</button>
  <button class="nav-btn ghost small" onclick="importData()">Import JSON</button>
</div>

<div class="container" id="app" style="display:none">

  <!-- Dashboard -->
  <section id="dashboard" class="card">
    <h2>üìä Dashboard</h2>
    <div class="dashboard-grid">
      <div class="dashboard-box">üì¶ Items: <div id="dashItems">0</div></div>
      <div class="dashboard-box">üí∞ Stock Value: <div id="dashInventoryValue">‚Çπ0.00</div></div>
      <div class="dashboard-box">üìà Total Sales: <div id="dashSales">‚Çπ0.00</div></div>
      <div class="dashboard-box">üìä Total Profit: <div id="dashProfit">‚Çπ0.00</div></div>
      <div class="dashboard-box">‚ö†Ô∏è Low Stock: <div id="dashLow">0</div></div>

      <!-- custom summary boxes -->
      <div class="dashboard-box">üîÅ Loans: <div id="dashLoansCount">0</div><div style="font-size:12px">Today loan total: <span id="dashLoansToday">‚Çπ0.00</span></div></div>
      <div class="dashboard-box">üíª Laptops: <div id="dashLaptopsCount">0</div><div style="font-size:12px">Today sales: <span id="dashLaptopsToday">‚Çπ0.00</span></div></div>
      <div class="dashboard-box">üßæ Expenses: <div id="dashExpensesCount">0</div><div style="font-size:12px">Today spend: <span id="dashExpensesToday">‚Çπ0.00</span></div></div>

      <div class="dashboard-box">Opening: <div id="dashopen">‚Çπ0.00</div></div>
      <div class="dashboard-box">Closing: <div id="dashClose">‚Çπ0.00</div></div>

      <div class="dashboard-box">
        <label>Set Opening :</label><input id="setOpenAmount" type="number" placeholder="0" style="width:120px"><br>
        <button class="small" onclick="setOpening()">Save</button>
        <button class="small ghost" onclick="resetOpening()">Reset</button>
      </div>

      <div class="dashboard-box" style="grid-column: span 2;">
        <h4>Opening History</h4>
        <ul id="openHistoryList" style="text-align:left;max-height:110px;overflow:auto;padding-left:14px"></ul>
      </div>
    </div>
  </section>

  <!-- Inventory -->
  <section id="inventory" class="card" style="display:none">
    <h2>üì¶ Inventory</h2>
    <div class="columns-2">
      <div>
        <h3>‚ûï Add / Update Item</h3>
        <input id="invName" placeholder="Item name" class="small" />
        <input id="invQty" type="number" placeholder="Quantity" class="small" />
        <input id="invActual" type="number" placeholder="Actual price (cost)" class="small" />
        <input id="invSell" type="number" placeholder="Selling price" class="small" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button onclick="addOrUpdateItem()">Save Item</button>
          <button class="ghost" onclick="clearInventoryForm()">Clear</button>
        </div>
      </div>
      <div>
        <h3>üîé Search & Export</h3>
        <input id="stockSearch" placeholder="Search by item..." oninput="renderStock()" class="small" />
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="ghost small" onclick="exportStockCSV()">Export Stock CSV</button>
          <button class="ghost small" onclick="downloadStockJSON()">Export Stock JSON</button>
          <button class="ghost small" onclick="clearAllStockConfirm()">Delete All Stock</button>
        </div>
      </div>
    </div>
    <table>
      <thead><tr><th>Item</th><th>Qty</th><th>Actual ‚Çπ</th><th>Selling ‚Çπ</th><th>Value</th><th>Actions</th></tr></thead>
      <tbody id="stockTbody"></tbody>
    </table>
    <div id="inventoryValue" style="margin-top:12px;font-weight:700"></div>
  </section>

  <!-- POS -->
<section id="pos" class="card"  style="display:none">
  <h2>üõí POS / Sell</h2>
  <div class="columns-2">
    <!-- Left Column -->
    <div>
      <h3>Add item to cart (you can specify payment method per item)</h3>
      <select id="posSelect" class="small"></select>
      <input id="posQty" type="number" placeholder="Qty" class="small" />
      <select id="posPaymentMethod" class="small" title="Payment Method">
        <option value="cash">Cash</option>
        <option value="gpay">GPay</option>
        <option value="phonepe">PhonePe</option>
        <option value="upi">UPI</option>
      </select>
      <input id="posUpi" placeholder="UPI ID (optional)" class="small" />
      <button onclick="addToCart()" style="margin-top:6px">Add to Cart</button>

      <h4 style="margin-top:12px">Cart</h4>
      <table>
        <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th><th>Payment</th><th>Action</th></tr></thead>
        <tbody id="cartTbody"></tbody>
      </table>
    </div>

    <!-- Right Column -->
    <div>
      <h3>Finalize Sale</h3>
      <input id="posBuyer" placeholder="Buyer name (optional)" class="small" />
      <input id="posMobile" placeholder="Buyer mobile (optional)" class="small" />
      <div style="margin-top:8px">
        <button onclick="completeSale()">Complete & Generate Invoice</button>
        <button class="ghost" onclick="clearCart()">Clear Cart</button>
      </div>

      <div style="margin-top:12px">
        <div><b>Cart Total:</b> ‚Çπ<span id="cartTotal">0.00</span></div>
        <div><b>Cart Profit (est):</b> ‚Çπ<span id="cartProfit">0.00</span></div>
        <div style="margin-top:8px">
          <button class="small ghost" onclick="printCurrentCartReceipt()">Print Bill (Bill-printer)</button>
        </div>
      </div>
    </div>
  </div>
</section>
  
  <!-- Transactions -->
  <section id="transactions" class="card" style="display:none">
    <h2>üßæ Transactions</h2>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <input id="transSearch" placeholder="Search item/buyer/mobile..." oninput="renderTransactions()" class="small" />
      <button class="ghost small" onclick="exportTransactionsCSV()">Export CSV</button>
    </div>
    <table>
      <thead><tr><th>Items</th><th>Buyer</th><th>Qty</th><th>Total ‚Çπ</th><th>Profit ‚Çπ</th><th>Payments</th><th>Date</th><th>Inv#</th></tr></thead>
      <tbody id="transTbody"></tbody>
    </table>
  </section>

  <!-- Reports -->
  <section id="reports" class="card" style="display:none">
    <h2>üìà Reports</h2>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <select id="reportFilter" class="small">
        <option value="all">All Time</option>
        <option value="today">Today</option>
        <option value="week">This Week</option>
        <option value="month">This Month</option>
      </select>
      <button class="ghost small" onclick="generateReport()">Apply</button>
      <button class="ghost small" onclick="downloadReportPDF()">Download Report PDF</button>
    </div>
    <div class="dashboard-grid" style="margin-top:12px">
      <div class="dashboard-box">üßæ Sales: <div id="repSales">‚Çπ0.00</div></div>
      <div class="dashboard-box">üí∞ Profit: <div id="repProfit">‚Çπ0.00</div></div>
      <div class="dashboard-box">üì¶ Items Sold: <div id="repItems">0</div></div>
    </div>
    <h4 style="margin-top:12px">Transactions</h4>
    <table>
      <thead><tr><th>Items</th><th>Buyer</th><th>Qty</th><th>Total ‚Çπ</th><th>Profit ‚Çπ</th><th>Date</th><th>Inv#</th></tr></thead>
      <tbody id="reportTbody"></tbody>
    </table>
  </section>

  <!-- Invoices -->
  <section id="invoices" class="card" style="display:none">
    <h2>üßæ Invoice History</h2>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="invoiceSearch" placeholder="Search invoice # or buyer..." oninput="renderInvoices()" class="small" />
      <button class="ghost small" onclick="exportInvoicesCSV()">Export Invoices CSV</button>
    </div>
    <table>
      <thead><tr><th>Inv#</th><th>Buyer</th><th>Total</th><th>Profit</th><th>Date</th><th>Actions</th></tr></thead>
      <tbody id="invoiceTbody"></tbody>
    </table>

    <div id="invoiceModal" class="card" style="display:none;margin-top:18px;">
      <h3>Invoice Preview</h3>
      <div id="invoiceContent"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button onclick="downloadBuyerCopy()">Download Buyer Copy (PDF)</button>
        <button onclick="downloadSellerCopy()">Download Seller Copy (PDF)</button>
        <button class="ghost" onclick="printReceipt()">Print Receipt (POS-style)</button>
        <button class="ghost" onclick="closeInvoicePreview()">Close</button>
      </div>
    </div>
  </section>

  <!-- Loans -->
  <section id="loans" class="card" style="display:none">
    <h2>üîÉ Loans</h2>
    <div class="columns-2">
      <div>
        <h3>Add Loan</h3>
        <!-- serial will be auto when empty -->
        <input id="loanSerial" placeholder="Serial (leave blank for auto)" class="small" />
        <input id="loanBorrower" placeholder="Borrower name" class="small" />
        <input id="loanMobile" placeholder="Mobile number" class="small" />
        <input id="loanScheme" placeholder="Scheme name (type freely)" class="small" />
        <input id="loanSize" placeholder="Loan size" type="number" class="small" />
        <input id="loanFees" placeholder="Loan fees" type="number" class="small" />
        <div style="margin-top:8px">
          <button onclick="addLoan()">Save Loan</button>
          <button class="ghost" onclick="clearLoanForm()">Clear</button>
        </div>
      </div>

      <div>
        <h3>Search & Export</h3>
        <input id="loanSearch" placeholder="Search by borrower/serial/scheme..." oninput="renderLoans()" class="small" />
        <div style="margin-top:8px">
          <button class="ghost small" onclick="exportLoansCSV()">Export Loans CSV</button>
          <button class="ghost small" onclick="clearAllLoansConfirm()">Delete All Loans</button>
        </div>
      </div>
    </div>

    <table>
      <thead><tr><th>Serial</th><th>Borrower</th><th>Mobile</th><th>Scheme</th><th>Size</th><th>Fees</th><th>Actions</th></tr></thead>
      <tbody id="loansTbody"></tbody>
    </table>
  </section>

  <!-- Laptops -->
  <section id="laptops" class="card" style="display:none">
    <h2>üíª Laptops (sales ledger)</h2>
    <div class="columns-2">
      <div>
        <h3>Add Laptop Sale</h3>
        <input id="lapSerial" placeholder="Serial (leave blank for auto)" class="small" />
        <input id="lapModel" placeholder="Laptop model/name" class="small" />
        <input id="lapBuy" type="number" placeholder="Buying price" class="small" />
        <input id="lapSell" type="number" placeholder="Selling price" class="small" />
        <input id="lapCustomer" placeholder="Customer name (optional)" class="small" />
        <input id="lapMobile" placeholder="Customer mobile (optional)" class="small" />
        <select id="lapPayment" class="small">
          <option value="cash">Cash</option>
          <option value="gpay">GPay</option>
          <option value="phonepe">PhonePe</option>
          <option value="upi">UPI</option>
        </select>
        <input id="lapUpi" placeholder="UPI ID (optional)" class="small" />
        <div style="margin-top:8px">
          <button onclick="addLaptop()">Save Laptop Entry</button>
          <button class="ghost" onclick="clearLaptopForm()">Clear</button>
        </div>
      </div>

      <div>
        <h3>Search & Export</h3>
        <input id="lapSearch" placeholder="Search model/customer/serial..." oninput="renderLaptops()" class="small" />
        <div style="margin-top:8px">
          <button class="ghost small" onclick="exportLaptopsCSV()">Export Laptops CSV</button>
          <button class="ghost small" onclick="clearAllLaptopsConfirm()">Delete All Laptops</button>
        </div>
      </div>
    </div>

    <table>
      <thead><tr><th>Serial</th><th>Model</th><th>Buy</th><th>Sell</th><th>Cust</th><th>Mobile</th><th>Payment</th><th>Actions</th></tr></thead>
      <tbody id="laptopsTbody"></tbody>
    </table>
  </section>

  <!-- Expenses -->
  <section id="expenses" class="card" style="display:none">
    <h2>üí∏ Own Expenses (Today)</h2>
    <div class="columns-2">
      <div>
        <h3>Add Expense</h3>
        <input id="expDesc" placeholder="Expense for (e.g. fuel, snacks)" class="small" />
        <input id="expAmt" type="number" placeholder="Amount" class="small" />
        <div style="margin-top:8px">
          <button onclick="addExpense()">Add Expense</button>
          <button class="ghost" onclick="clearExpenseForm()">Clear</button>
        </div>
      </div>

      <div>
        <h3>Today Summary</h3>
        <div style="font-weight:700">Total today: <span id="expensesTodayTotal">‚Çπ0.00</span></div>
        <div style="margin-top:8px">
          <button class="ghost small" onclick="exportExpensesCSV()">Export Expenses CSV</button>
          <button class="ghost small" onclick="clearAllExpensesConfirm()">Clear All Expenses</button>
        </div>
      </div>
    </div>

    <table>
      <thead><tr><th>Time</th><th>Description</th><th>Amount</th><th>Actions</th></tr></thead>
      <tbody id="expensesTbody"></tbody>
    </table>
  </section>

  <!-- Settings -->
  <section id="settings" class="card" style="display:none">
    <h2>‚öôÔ∏è Settings</h2>
    <div class="columns-2">
      <div>
        <h4>Shop Info</h4>
        <input id="shopName" placeholder="Shop name" class="small" />
        <input id="shopAddress" placeholder="Shop address" class="small" />
        <input id="shopGST" placeholder="GST / Tax no" class="small" />
        <input id="shopContact" placeholder="Contact number" class="small" />
        <div style="margin-top:8px">
          <input id="shopLogo" type="file" accept="image/*" onchange="uploadLogo(event)" />
          <div style="margin-top:8px"><img id="logoPreview" style="max-width:120px;display:none;border:1px solid #e6eefb;padding:6px;border-radius:6px" /></div>
        </div>
        <div style="margin-top:8px">
          <button onclick="saveSettings()">Save Settings</button>
          <button class="ghost" onclick="resetSettings()">Reset</button>
        </div>
      </div>

      <div>
        <h4>Admin Account</h4>
        <div class="notice">Change admin username & password (current session will remain).</div>
        <input id="adminUser" placeholder="New username" class="small" />
        <input id="adminPass" placeholder="New password" type="password" class="small" />
        <input id="adminPassConfirm" placeholder="Confirm password" type="password" class="small" />
        <div style="margin-top:8px">
          <button onclick="changeAdmin()">Update Admin</button>
        </div>

        <h4 style="margin-top:14px">Backup / Restore</h4>
        <button class="ghost small" onclick="exportAllData()">Export All (JSON)</button>
        <button class="ghost small" onclick="importData()">Import (JSON)</button>
        <div style="margin-top:12px">
          <button class="ghost small" onclick="clearAllDataConfirm()">Clear ALL Data (careful)</button>
        </div>
      </div>
    </div>
  </section>

</div>

<!-- Login overlay -->
<div id="loginOverlay">
  <div id="loginCard" role="dialog" aria-modal="true">
    <h3>Login ‚Äî Admin</h3>
    <div class="notice">Default: admin / admin ‚Äî First time you can change credentials in Settings.</div>
    <input id="loginUser" placeholder="Username" class="small" style="width:100%;margin-bottom:8px" />
    <input id="loginPass" placeholder="Password" type="password" class="small" style="width:100%;margin-bottom:8px" />
    <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
      <button onclick="login()">Login</button>
      <button class="ghost" onclick="showResetAdmin()">Reset Admin</button>
    </div>
    <div style="margin-top:10px;font-size:13px;color:#777">If you don't know credentials click "Reset Admin" to restore default (admin/admin).</div>
  </div>
</div>

<script src="app.js"></script>
</body>

</html>
